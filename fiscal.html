<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Fiscal — Sistema de Produção</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --ink:#111827; --muted:#6b7280;
      --primary:#2563eb; --primary-ink:#fff; --border:#e5e7eb;
      --good:#16a34a; --bad:#dc2626; --chip:#eef2ff; --chip-ink:#1e40af;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg); color:var(--ink);
    }
    .header{
      position:fixed; top:0; left:0; right:0; z-index:50;
      background:#fff; border-bottom:1px solid var(--border);
      display:flex; align-items:center; gap:12px;
      padding:12px 16px;
    }
    .who-badge{background:#f3f4f6; color:#111827; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:600;}
    .wrap{max-width:1100px; margin:0 auto; padding:98px 16px 24px;}
    .card{background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:0 4px 14px rgba(17,24,39,.05); margin-bottom:16px; overflow:hidden;}
    .card .hd{padding:14px 16px; border-bottom:1px solid var(--border); font-weight:700; display:flex; align-items:center; gap:12px;}
    .card .bd{padding:16px}
    .pill{background:var(--chip); color:var(--chip-ink); border:0; border-radius:999px; padding:8px 12px; cursor:pointer; font-weight:600; font-size:13px;}
    .pill.is-active{background:var(--primary); color:#fff}
    table{width:100%; border-collapse:collapse; border-spacing:0; table-layout:fixed}
    th,td{padding:10px 10px; border-bottom:1px solid var(--border); font-size:13.5px; text-align:left; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    thead th{background:#f3f4f6; color:var(--muted);}
    tbody tr:nth-child(even){background:#f9fafb}
  </style>
</head>
<body>
  <header class="header">
    <div>
      <div class="title">Sistema de Produção Tributário — Painel do Fiscal</div>
      <div class="sub">Registre seus serviços e acompanhe seus lançamentos</div>
    </div>
    <div class="right">
      <span id="who" class="who-badge">Conectando…</span>
      <button id="btnSair" class="btn-ghost">Sair</button>
    </div>
  </header>

  <div class="wrap" id="conteudo" style="display:none">
    <div id="msg" class="msg"></div>

    <!-- Lançamento -->
    <div class="card">
      <div class="hd"><span id="tituloForm">Novo lançamento</span></div>
      <div class="bd">
        <!-- (formulário igual ao seu original, omitido para foco) -->
        <button id="btnAdd" type="button">Adicionar</button>
      </div>
    </div>

    <!-- Filtros -->
    <div class="card">
      <div class="hd"><span>Filtrar lançamentos por mês e ano</span></div>
      <div class="bd">
        <div class="toolbar">
          <label for="anoFiltro">Ano:</label>
          <input id="anoFiltro" type="number" min="2020" max="2100" style="width:120px">
          <div id="mesBtns"></div>
        </div>
      </div>
    </div>

    <!-- Lista -->
    <div class="card">
      <div class="hd"><span>Meus lançamentos</span><div class="right toolbar"><small id="totalMes" class="sub"></small></div></div>
      <div class="bd">
        <table id="tab" class="table">
          <thead>
            <tr><th>Data</th><th>Empresa</th><th>CNPJ/CPF</th><th>Descrição</th><th>Qtd</th><th>Valor</th><th>Destino</th><th>Resumo</th><th>Ações</th></tr>
          </thead>
          <tbody></tbody>
          <tfoot><tr><td colspan="9" id="tfootTotal">Total do mês: R$ 0,00</td></tr></tfoot>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { inicializarFiltros } from "./filtros.js";
    import { inicializarTabela } from "./meus_lancamentos.js";

    window.addEventListener('DOMContentLoaded', () => {
      const firebaseConfig = {
        apiKey: "AIzaSyANrr4R5JtJ9GmO0j-1X8-9CvBmYkC4oCI",
        authDomain: "fiscalizacao9557.firebaseapp.com",
        projectId: "fiscalizacao9557",
        storageBucket: "fiscalizacao9557.firebasestorage.app",
        messagingSenderId: "98041336495",
        appId: "1:98041336495:web:0475dfd9c0490cc0a17a5a"
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const $ = s => document.querySelector(s);
      const showMsg = (t, cls='ok') => { const m=$('#msg'); m.textContent=t; m.className='msg '+cls; m.style.display='block'; setTimeout(()=>m.style.display='none',2500); };
      const numberToBRL = n => (Number(n||0)).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

      let sess = JSON.parse(localStorage.getItem('sessao_usuario')||'null');
      if(!sess || sess.tipo!=='fiscal'){ location.href='index.html'; return; }
      $('#conteudo').style.display='block';
      $('#who').textContent = `${sess.nome} (Fiscal)`;
      $('#anoFiltro').value = new Date().getFullYear();
      window.anoAtivo = parseInt($('#anoFiltro').value,10);

      // === Inicializações modulares ===
      const renderMeus = inicializarTabela(db, sess, numberToBRL, showMsg);
      inicializarFiltros(renderMeus);
      renderMeus();
    });
  </script>
</body>
</html>
